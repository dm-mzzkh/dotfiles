#!/bin/sh

set -eu

BASE_DIR="${TEST_FOLDER:-"$HOME/tests"}"
START_SHELL="${SHELL:-/bin/sh}"

mkdir -p "$BASE_DIR"

find "$BASE_DIR" -mindepth 1 -maxdepth 1 -type d -empty -exec rmdir {} +

counter=1

while :; do
    folder_name=$(printf "%02d" "$counter")
    folder_path="$BASE_DIR/$folder_name"

    if [ ! -d "$folder_path" ]; then
        mkdir "$folder_path"
        break
    fi

    counter=$((counter + 1))
done

cd "$folder_path"

exec "$START_SHELL"
